name: Test and coverage report with Codecov
on: [push, pull_request]

jobs:
  test:
    name: Run tests and collect coverage
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Node
        uses: actions/setup-node@v4

      - name: Install dependencies
        run: yarn install

      - name: Run tests
        run: npx jest --coverage

      - name: Upload results to Codecov
        uses: codecov/codecov-action@v5
        with:
          token: ${{ secrets.CODECOV_TOKEN }}
          
    # Deploy:
    #   runs-on: ubuntu-latest
    #   steps:
    #     - name: Checkout the repo
    #       uses: actions/checkout@v2

    #     - name: Deploy to EC2
    #       uses: appleboy/ssh-action@master
    #       with:
    #         host: ${{ secrets.HOST }}
    #         username: ${{ secrets.USERNAME }}
    #         key: ${{ secrets.PRIVATE_KEY }}
    #         script: |
    #           cd ~
    #           pm2 stop all
    #           rm -rf openai-chatbot
    #           git clone https://github.com/vinitparekh17/openai-server.git openai-chatbot
    #           cd openai-chatbot
    #           yarn install
    #           yarn build
    #           pm2 start dist/index.js
